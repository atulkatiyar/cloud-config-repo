@Test
    void removeExpiredEntries_RemovesExpiredEntry() throws InterruptedException {
        // Set up cache with a very short expiration time
        cache = Log4JCache.getInstance(TimeUnit.MILLISECONDS, 100);
        cache.put(TEST_KEY, TEST_VALUE);
        
        // Wait for the entry to expire
        Thread.sleep(200);
        
        // Try to get the expired entry
        assertNull(cache.get(TEST_KEY), "Entry should have been removed after expiration");
    }

    @Test
    void removeExpiredEntries_RetainsValidEntry() throws InterruptedException {
        // Set up cache with a longer expiration time
        cache = Log4JCache.getInstance(TimeUnit.SECONDS, 2);
        cache.put(TEST_KEY, TEST_VALUE);
        
        // Wait for a short time, but not long enough for expiration
        Thread.sleep(500);
        
        // Entry should still be present
        assertEquals(TEST_VALUE, cache.get(TEST_KEY), "Entry should still be present before expiration");
    }

    @Test
    void removeExpiredEntries_HandlesMultipleEntries() throws InterruptedException {
        // Set up cache with different expiration times
        cache = Log4JCache.getInstance(TimeUnit.MILLISECONDS, 200);
        
        // Add multiple entries
        cache.put("short-lived", "expire-soon");
        Thread.sleep(100);
        cache.put("long-lived", "expire-later");
        
        // Wait for first entry to expire
        Thread.sleep(150);
        
        // Check results
        assertNull(cache.get("short-lived"), "Short-lived entry should have expired");
        assertNotNull(cache.get("long-lived"), "Long-lived entry should still be present");
    }

    @Test
    void removeExpiredEntries_HandlesEmptyCache() throws InterruptedException {
        // Set up cache with a short expiration time
        cache = Log4JCache.getInstance(TimeUnit.MILLISECONDS, 100);
        
        // Wait for some time
        Thread.sleep(200);
        
        // Verify no exceptions are thrown when cache is empty
        assertNull(cache.get(TEST_KEY));
    }

    @Test
    void removeExpiredEntries_HandlesNullTimestamp() throws InterruptedException {
        // Set up cache with a short expiration time
        cache = Log4JCache.getInstance(TimeUnit.MILLISECONDS, 100);
        
        // Directly add a value to cache without timestamp (simulating edge case)
        cache.put(TEST_KEY, TEST_VALUE);
        // Force remove the timestamp
        cache.clearAll(TEST_KEY);
        cache.put(TEST_KEY, TEST_VALUE);
        
        // Wait for expiration time
        Thread.sleep(200);
        
        // Entry should still be present as timestamp was null
        assertNull(cache.get(TEST_KEY), "Entry should be removed even with null timestamp");
    }

    @Test
    void removeExpiredEntries_HandlesRapidPutAndRemove() throws InterruptedException {
        cache = Log4JCache.getInstance(TimeUnit.MILLISECONDS, 100);
        
        // Rapidly add and remove entries
        for (int i = 0; i < 10; i++) {
            cache.put(TEST_KEY + i, TEST_VALUE);
            if (i % 2 == 0) {
                cache.clearAll(TEST_KEY + i);
            }
            Thread.sleep(20);
        }
        
        // Wait for expiration
        Thread.sleep(200);
        
        // Verify all entries are removed
        for (int i = 0; i < 10; i++) {
            assertNull(cache.get(TEST_KEY + i), "Entry " + i + " should be removed");
        }
    }

    @Test
    void shutdown_StopsScheduler() throws InterruptedException {
        cache = Log4JCache.getInstance(TimeUnit.MILLISECONDS, 100);
        cache.put(TEST_KEY, TEST_VALUE);
        
        // Shutdown the cache
        cache.shutdown();
        
        // Wait for what would have been the expiration time
        Thread.sleep(200);
        
        // Entry should still be present as scheduler was shutdown
        assertEquals(TEST_VALUE, cache.get(TEST_KEY), "Entry should remain after shutdown");
    }
