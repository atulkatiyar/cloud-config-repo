rror calling REST API to fetch updated Log4j2.xml file: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
Calling /Log4j.xml service to fetch updated Logging level : at 2025-03-03T19:36:05.530318580Z



echo -n | openssl s_client -connect your-service-url:443 | openssl x509 > certificate.pem


keytool -importcert -file certificate.pem -keystore truststore.jks -alias customcert

java -Djavax.net.ssl.trustStore=/path/to/truststore.jks \
     -Djavax.net.ssl.trustStorePassword=changeit \
     -javaagent:/app/log-level-agent.jar -jar app.jar


  SSL_ENABLED         : true
  SSL_KEY_STORE_ALIAS : lsegippseks
  SSL_KEY_STORE_PATH  : /config/keystore.jks
  SSL_KEY_STORE_TYPE  : PKCS12
  ssl_secret_name     : ipps-dev-psl-eks-ssl-password


-javaagent:/path/to/your-agent.jar 
-Djavax.net.ssl.trustStore=/config/keystore.jks 
-Djavax.net.ssl.trustStoreType=PKCS12 
-Djavax.net.ssl.trustStorePassword=${SSL_PASSWORD}


public static void fetchUpdatedLog4jXml() {
    try {
        String loggingLevelClientAppUrl = System.getProperty(LOG_LEVEL_CONTROLLER_HOST) + "/" + LOG4J2_XML_FILE_NAME;
        System.out.println("Calling /Log4j.xml service to fetch updated Logging level : at " + Instant.now());
        
        // Get system properties for SSL
        String trustStorePath = System.getProperty("javax.net.ssl.trustStore");
        String trustStorePassword = System.getProperty("javax.net.ssl.trustStorePassword");
        String trustStoreType = System.getProperty("javax.net.ssl.trustStoreType", "JKS");
        
        // Log the SSL configuration being used (for debugging purposes)
        System.out.println("Using trustStore: " + trustStorePath);
        System.out.println("Using trustStoreType: " + trustStoreType);
        
        // Only set up custom SSL context if trustStore is specified
        if (trustStorePath != null && !trustStorePath.isEmpty()) {
            // Initialize the trust store
            KeyStore trustStore = KeyStore.getInstance(trustStoreType);
            try (FileInputStream trustStoreStream = new FileInputStream(trustStorePath)) {
                trustStore.load(trustStoreStream, trustStorePassword.toCharArray());
            }
            
            // Set up trust manager factory
            TrustManagerFactory tmf = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());
            tmf.init(trustStore);
            
            // Create SSL context with our trust manager
            SSLContext sslContext = SSLContext.getInstance("TLS");
            sslContext.init(null, tmf.getTrustManagers(), null);
            
            // Set the default SSL socket factory
            HttpsURLConnection.setDefaultSSLSocketFactory(sslContext.getSocketFactory());
        }
        
        URL url = new URL(loggingLevelClientAppUrl);
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        connection.setRequestProperty("Accept", "application/xml");
        connection.setRequestMethod("GET");
        connection.setConnectTimeout(TIMEOUT);
        connection.setReadTimeout(TIMEOUT);
        int responseCode = connection.getResponseCode();
        if (responseCode == 200) {
            File outputFile = new File(LOG4J2_XML_FILE_NAME);
            try (InputStream inputStream = connection.getInputStream();
                 FileOutputStream fileOutputStream = new FileOutputStream(outputFile)) {
                byte[] buffer = new byte[1024];
                int bytesRead;
                while ((bytesRead = inputStream.read(buffer)) != -1) {
                    fileOutputStream.write(buffer, 0, bytesRead);
                }
            }
        } else {
            System.err.println("Error fetching Log4j2.xml: HTTP response code " + responseCode);
        }
    } catch (Exception e) {
        System.err.println("Error calling REST API to fetch updated Log4j2.xml file: " + e.getMessage());
        e.printStackTrace();  // Add stack trace for better debugging
    }
}
