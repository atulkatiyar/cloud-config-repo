class LogLevelStartUpAgentTest {

    @Test
    void testFetchUpdatedLog4jXmlSuccess() throws Exception {
        // Mock System properties
        try (MockedStatic<System> systemMock = mockStatic(System.class)) {
            systemMock.when(() -> System.getProperty("log.level.controller.host"))
                    .thenReturn("http://mocked-host");

            // Mock URL and HttpURLConnection
            HttpURLConnection mockConnection = mock(HttpURLConnection.class);
            URL mockUrl = mock(URL.class);

            when(mockUrl.openConnection()).thenReturn(mockConnection);
            when(mockConnection.getResponseCode()).thenReturn(200);
            when(mockConnection.getInputStream()).thenReturn(new ByteArrayInputStream("mocked-xml-content".getBytes()));

            try (MockedStatic<URL> urlMock = mockStatic(URL.class)) {
                urlMock.when(() -> new URL("http://mocked-host/log4j2.xml"))
                        .thenReturn(mockUrl);

                // Call the method
                LogLevelStartUpAgent.fetchUpdatedLog4jXml();

                // Verify
                verify(mockConnection).setRequestProperty("Accept", "application/xml");
                verify(mockConnection).setRequestMethod("GET");
                verify(mockConnection).setConnectTimeout(LogLevelStartUpAgent.TIMEOUT);
                verify(mockConnection).setReadTimeout(LogLevelStartUpAgent.TIMEOUT);

                // Check if the file is created
                File outputFile = new File("log4j2.xml");
                assertTrue(outputFile.exists());
                outputFile.delete(); // Clean up after test
            }
        }
    }

    @Test
    void testFetchUpdatedLog4jXmlErrorResponse() throws Exception {
        // Mock System properties
        try (MockedStatic<System> systemMock = mockStatic(System.class)) {
            systemMock.when(() -> System.getProperty("log.level.controller.host"))
                    .thenReturn("http://mocked-host");

            // Mock URL and HttpURLConnection
            HttpURLConnection mockConnection = mock(HttpURLConnection.class);
            URL mockUrl = mock(URL.class);

            when(mockUrl.openConnection()).thenReturn(mockConnection);
            when(mockConnection.getResponseCode()).thenReturn(500);

            try (MockedStatic<URL> urlMock = mockStatic(URL.class)) {
                urlMock.when(() -> new URL("http://mocked-host/log4j2.xml"))
                        .thenReturn(mockUrl);

                // Call the method
                LogLevelStartUpAgent.fetchUpdatedLog4jXml();

                // Verify
                verify(mockConnection).setRequestProperty("Accept", "application/xml");
                verify(mockConnection).setRequestMethod("GET");
                verify(mockConnection).setConnectTimeout(LogLevelStartUpAgent.TIMEOUT);
                verify(mockConnection).setReadTimeout(LogLevelStartUpAgent.TIMEOUT);

                // Check that no file is created
                File outputFile = new File("log4j2.xml");
                assertFalse(outputFile.exists());
            }
        }
    }

    @Test
    void testFetchUpdatedLog4jXmlInvalidHost() {
        // Mock System properties
        try (MockedStatic<System> systemMock = mockStatic(System.class)) {
            systemMock.when(() -> System.getProperty("log.level.controller.host"))
                    .thenReturn(null);

            // Call the method
            LogLevelStartUpAgent.fetchUpdatedLog4jXml();

            // Check that no file is created
            File outputFile = new File("log4j2.xml");
            assertFalse(outputFile.exists());
        }
    }
}
