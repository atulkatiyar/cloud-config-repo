Dear Colleagues (bcc),

Please be informed that EDI Fundamentals Mandatory training 3/3 (3d part of 3 of EDI Fundamentals) was assigned to you in LSEG Workday Portal (LSEG environment).

Kindly asking you to complete the learning ASAP If you‚Äôve already completed the course ‚Äì please ignore the email.
‚Ä¢	The training is not visible in the LSEG Workday Portal in ‚ÄúMy Learning‚Äù tab as a mandatory, so you should access course by clicking the direct link ( from the LSEG environment) :https://wd3.myworkday.com/lseg/d/inst/1$17188/23455$2185.htmld  
An additional reminder was sent to your LSEG email address as well.

Please pay attention that the course consists of 2 chapters, kindly make sure you‚Äôve completed each of them:


{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "export.rds.amazonaws.com"
            },
            "Action": "sts:AssumeRole"
        }
    ]
}


üéØ Summary
IAM Role	Purpose	Key Permissions
IAM_ROLE_FOR_EXPORT	-> Allows RDS to export snapshots to S3	-> AmazonS3FullAccess, AWSRDSDataFullAccess, AWSKeyManagementServicePowerUser
IAM_ROLE_FOR_S3_REPLICATION	-> Allows another AWS account to access backups in S3	-> s3:GetObject, s3:ListBucket
Destination Bucket Policy ->	Allows Account A to replicate data into Account B	-> s3:ReplicateObject, s3:ObjectOwnerOverrideToBucketOwner



"rds:CreateDBClusterSnapshot",
                "rds:DescribeDBClusterSnapshots",
                "rds:ModifyDBClusterSnapshotAttribute



rds:CopyDBClusterSnapshot",
                "rds:DescribeDBClusterSnapshots"


write gitlab pipeline which takes package name and its Log level and its expiry time(milli sec) in from gitlab WEB pipeline UI and put that in AWS param store




variables:
  AWS_REGION: "eu-west-1"  # Change to your AWS region
  PARAMETER_PATH: "/log-config"
  PACKAGE_NAME:
    value: "com.example"  # Default is empty; user must enter a value
  LOG_LEVEL:
    value: "INFO"  # Default value
  EXPIRY_TIME:
    value: "3600000"
  ENVIRONMENT_NAME:
    value: "---"
    options:
      - "dev2"
      - "nfr"
      - "uat"
      - "Prod"
      - "---"
    description: "select the target environment"

workflow:
   rules:
     - if: $ENVIRONMENT_NAME =~ /^nfr.*/
       variables:
         RUNNER_TAG: "psl-epam-runner-qa"
         TARGET_AWS_ACCOUNT: "332028679471"
         AWS_ACCOUNT_NAME: "qa"
     - if: $ENVIRONMENT_NAME =~ /^uat.*/
       variables:
         RUNNER_TAG: "psl-epam-runner-uat"
         TARGET_AWS_ACCOUNT: "851725348656"
         AWS_ACCOUNT_NAME: "uat"
     - if: $ENVIRONMENT_NAME =~ /^prod.*/
       variables:
         RUNNER_TAG: "psl-epam-runner-prod"
         TARGET_AWS_ACCOUNT: "730335637172"
         AWS_ACCOUNT_NAME: "prod"
     - if: $ENVIRONMENT_NAME =~ /^dev2.*/
       variables:
         RUNNER_TAG: "psl-epam-runner"
         TARGET_AWS_ACCOUNT: "729500479720"
         AWS_ACCOUNT_NAME: "dev"
     - when: always

include:  
  - project: 'ci/stable/security/vault/vault-integrator'
    ref: '4.1.0' # https://gitlab.dx1.lseg.com/ci/stable/security/vault/vault-integrator/-/tree/master/
    file:
      - 'templates/vault-integrator.yml'

stages:
  - authenticate
  - store-log-config
.prepare:
   before_script:
    - |
      echo "Account = $AWS_ACCOUNT_NAME | Account ID = $TARGET_AWS_ACCOUNT"

auth:
  stage: authenticate
  extends: [.vault-aws-auth]
  variables:
    LSEG_PPE_VAULT: "true"  
    AWS_ACCOUNT: "$TARGET_AWS_ACCOUNT"    
  tags: ["LSEG"]
  rules:
    - if: $ENVIRONMENT_NAME != "---" &&  $ENVIRONMENT_NAME =~ /^(dev2|nfr|uat|prod)$/



store_log_config:
  needs:
    - auth
  tags: ["$RUNNER_TAG"]

  stage: store-log-config
  image: registry.dx1.lseg.com/app/app-50339/iac-temp/psl-base-docker-image/psl/awscli-docker:latest  # Using AWS CLI Docker image
  variables:
    PACKAGE_NAME:
      value: ""  # Default is empty; user must enter a value
    LOG_LEVEL:
      value: "INFO"  # Default value
    EXPIRY_TIME:
      value: "3600000"  # Default value (1 hour)
  script:
    - CURRENT_TIME=$(date +%s)
    - EXPIRY_TIMESTAMP=$(($CURRENT_TIME + $EXPIRY_TIME / 1000))  # Convert milliseconds to seconds
    - echo "Storing log level configuration in AWS Parameter Store..."
    
    # Check if required variables are set
    - |
      if [[ -z "$PACKAGE_NAME" || -z "$LOG_LEVEL" || -z "$EXPIRY_TIME" ]]; then
        echo "‚ùå ERROR: One or more required variables are missing! Please provide PACKAGE_NAME, LOG_LEVEL, and EXPIRY_TIME."
        exit 1
      fi
    
    # Construct the JSON payload
    - PARAMETER_VALUE="{\"package\":\"$PACKAGE_NAME\",\"log_level\":\"$LOG_LEVEL\",\"expiry_time\":\"$EXPIRY_TIME\"}"
    
    # Store in AWS Systems Manager Parameter Store
    - |
      aws ssm put-parameter \
        --name "$PARAMETER_PATH/$PACKAGE_NAME" \
        --value "$PARAMETER_VALUE" \
        --type "SecureString" \
        --overwrite \
        --region "$AWS_REGION"
        --policies "[{\"Type\":\"Expiration\",\"Version\":\"1.0\",\"Attributes\":{\"Timestamp\":\"$(date -u -d @$EXPIRY_TIMESTAMP +'%Y-%m-%dT%H:%M:%SZ')\"}}]"

    
    - echo "‚úÖ Log level configuration stored successfully!"
    
  only:
    - feature/FRPS-19759

